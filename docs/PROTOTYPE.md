# V4Corner 网页原型设计

本文档描述了 V4Corner 项目的网页原型，包含用户登录和博客功能的完整页面设计。

---

## 设计原则

基于当前项目的简洁风格：
- **配色**：白色卡片 + 浅灰渐变背景（`#f8fafc` → `#e2e8f0`）
- **字体**：Inter / system-ui，现代无衬线字体
- **布局**：最大宽度 960px 居中，响应式设计
- **交互**：简洁的导航栏，清晰的视觉层次

---

## 页面结构

### 1. 导航栏（全局）

**当前状态**：
```
[V4Corner] [Home] [Blogs] [About]
```

**更新后**：
```
[V4Corner] [首页] [博客] [成员] [AI对话] 💬

未登录时显示：[登录] [注册]
已登录时显示：[头像/用户名] ▼ 点击显示下拉菜单
  - 我的博客
  - 个人中心
  - 退出登录
```

**交互说明**：
- 点击[AI对话]跳转到AI对话列表页（需要登录）
- 点击头像/用户名显示下拉菜单
- 未登录时点击博客详情页的"编辑"/"删除"，跳转到登录页并提示"请先登录"
- 未登录时点击[AI对话]，跳转到登录页并提示"请先登录后使用AI对话功能"

---

## 2. 登录页面 `/login`

### 页面布局

```
┌─────────────────────────────────────┐
│          [V4Corner]                 │
│                                     │
│     ┌─────────────────────────┐    │
│     │      登录到 V4Corner    │    │
│     ├─────────────────────────┤    │
│     │                         │    │
│     │  [用户名或邮箱]          │    │
│     │                         │    │
│     │  [密码]                  │    │
│     │                         │    │
│     │  [ ] 记住我              │    │
│     │                         │    │
│     │  [   登   录   ]         │    │
│     │                         │    │
│     │  还没有账号？[立即注册]   │    │
│     │                         │    │
│     └─────────────────────────┘    │
│                                     │
└─────────────────────────────────────┘
```

### 字段说明

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| username_or_email | string | 是 | 用户名或邮箱地址 |
| password | string | 是 | 密码（加密传输） |
| remember_me | boolean | 否 | 记住登录状态（7天） |

### 样式规格
- 登录框宽度：400px
- 居中显示
- 白色卡片，带阴影
- 输入框高度：44px
- 按钮高度：48px
- 按钮背景色：`#0f172a`（深色）
- 按钮文字：白色
- 错误提示：输入框下方红色文字

### API 调用
- 成功后保存 JWT Token 到 localStorage
- 跳转到之前访问的页面或首页

---

## 3. 注册页面 `/register`

### 页面布局

```
┌─────────────────────────────────────┐
│          [V4Corner]                 │
│                                     │
│     ┌─────────────────────────┐    │
│     │      注册 V4Corner      │    │
│     ├─────────────────────────┤    │
│     │                         │    │
│     │  [用户名]               │    │
│     │    3-20个字符            │    │
│     │                         │    │
│     │  [邮箱]                 │    │
│     │                         │    │
│     │  [密码]                 │    │
│     │    至少6个字符            │    │
│     │                         │    │
│     │  [确认密码]             │    │
│     │                         │    │
│     │  [昵称]（可选）         │    │
│     │                         │    │
│     │  [   注   册   ]         │    │
│     │                         │    │
│     │  已有账号？[立即登录]     │    │
│     │                         │    │
│     └─────────────────────────┘    │
│                                     │
└─────────────────────────────────────┘
```

### 字段说明

| 字段 | 类型 | 必填 | 验证规则 |
|------|------|------|----------|
| username | string | 是 | 3-20字符，字母数字下划线，唯一 |
| email | string | 是 | 邮箱格式，唯一 |
| password | string | 是 | 6-20字符 |
| password_confirm | string | 是 | 与 password 一致 |
| nickname | string | 否 | 2-20字符 |

### 交互说明
- 输入时实时验证（失去焦点时）
- 用户名/邮箱重复时提示
- 两次密码不一致时提示
- 注册成功后自动登录

---

## 4. 首页 `/`（优化版 v1.3.1）

### 当前状态
v1.3.0 三栏布局：左侧栏（日历）+ 中间栏（通知、博客）+ 右侧栏（签到）

### 优化后布局（v1.3.1 混合版）

```
┌──────────────────────────────────────────────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] ...                                           │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  欢迎来到 V4Corner                                                            │
│  行健-车辆4班的班级空间                                                       │
│                                                                              │
│  ┌────────────┐  ┌───────────────────────────────────────────────┐  ┌─────┐│
│  │ 📊 数据   │  │  🔴 重要通知                                 │  │ ✅   ││
│  │ ──────── │  │  ─────────────────────────────────────────────  │  │ 签到 ││
│  │ 28成员   │  │  期中答辩时间调整至本周四下午                   │  │ ─────││
│  │ 156博客  │  │  请各位同学做好准备，答辩地点：主楼 A301          │  │      ││
│  │ 7天连续  │  └───────────────────────────────────────────────┘  │ 📅   ││
│  └────────────┘                                                  │ 日历  ││
│  ┌────────────┐  ┌───────────────────────────────────────────────┐  │ ─────││
│  │ 🏷️ 分类   │  │  📝 精选博客                                  │  │      ││
│  │ ──────── │  │  ─────────────────────────────────────────────  │  │      ││
│  │ 📚 学习  │  │  ┌─────────┐ ┌─────────┐ ┌─────────┐           │  │      ││
│  │   42篇   │  │  │📚学习笔记│ │💻项目分享│ │💡经验总结│           │  │      ││
│  │ 💻 项目  │  │  └─────────┘ └─────────┘ └─────────┘           │  │      ││
│  │   38篇   │  │  [机器学习入门] [深度学习应用] [数据结构]       │  │      ││
│  │ 🎯 活动  │  └───────────────────────────────────────────────┘  │      ││
│  │   28篇   │                                                        │      ││
│  │ 💡 经验  │  ┌───────────────────────────────────────────────┐  │      ││
│  │   48篇   │  │  💬 最新动态                                  │  │      ││
│  └────────────┘  │  ─────────────────────────────────────────────  │  └─────┘│
│                  │  📝 张三 发布了新博客《机器学习入门指南》        │       │
│                  │  ✅ 李四 连续签到7天，获得"坚持不懈"成就！       │       │
│                  │  💬 王五 评论了赵六的博客                      │       │
│                  │  🎉 班级迎来了第28位成员                       │       │
│                  └───────────────────────────────────────────────┘       │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 内容说明
- **Hero 区域**：欢迎语 + 简短介绍
- **三栏布局**：
  - **左侧栏**（320px）：
    - 📊 **班级数据统计**：成员数、博客数、连续签到天数（紫色渐变卡片）
    - 🏷️ **博客分类导航**：学习笔记、项目分享、活动记录、经验总结
  - **中间栏**（最大 960px）：主内容区
    - 🔴 **重要通知置顶**：红色边框醒目显示关键通知
    - 📝 **精选博客**：卡片式布局，分类标签+标题+摘要+元信息
    - 💬 **最新动态**：混合显示各类活动（发博客、签到成就、评论等）
  - **右侧栏**（320px）：
    - ✅ **签到板块**：每日签到、运势抽签
    - 📅 **班级日历**：缩小版月视图，点击显示当日日程

### 新增板块详情

**📊 班级数据统计卡片**
- 紫色渐变背景，金色数字
- 显示三个核心指标：班级成员数、发布博客数、连续签到天数
- 视觉焦点突出，增强班级凝聚力

**🏷️ 博客分类导航**
- 图标 + 名称 + 数量徽章
- 悬浮时向右滑动，背景变为主题色
- 四大分类：学习笔记、项目分享、活动记录、经验总结

**🔴 重要通知置顶**
- 红色左侧边框 + 红色徽章标识
- 渐变背景（淡红色）突出重要性
- 只展示1条最紧急的通知

**📝 精选博客（卡片式）**
- 网格布局，自适应列数（minmax(280px, 1fr)）
- 每张卡片包含：分类标签、标题（2行截断）、摘要（2行截断）、元信息（作者、日期、浏览量）
- 悬浮时上浮4px，阴影加深

**💬 最新动态（混合流）**
- 图标 + 文本 + 时间的时间流布局
- 多种动态类型：发布博客、签到成就、评论、新成员等
- 背景色区分，悬浮时高亮

### 改进亮点

1. **信息密度提升** ⭐⭐⭐⭐⭐
   - 左中右三栏内容均衡，无空白区域
   - 数据统计、分类、动态丰富首页内容

2. **视觉层次优化** ⭐⭐⭐⭐⭐
   - 重要通知置顶，一目了然
   - 博客卡片式展示，更吸引眼球
   - 动态混合流，增强活跃度感知

3. **交互体验增强** ⭐⭐⭐⭐
   - 分类导航悬浮效果
   - 博客卡片上浮动画
   - 动态条目高亮反馈

4. **数据驱动** ⭐⭐⭐⭐⭐
   - 班级数据实时展示
   - 分类数量统计
   - 多维度动态呈现

---

## 4.1 签到功能（新增 v1.3.0）

### 当前状态
简单的欢迎文字

### 改进后布局

```
┌──────────────────────────────────────────────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] ...                                           │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  欢迎来到 V4Corner                                                            │
│  行健-车辆4班的班级空间                                                       │
│                                                                              │
│  ┌────────────┐  ┌───────────────────────────────────────────────┐  ┌─────┐│
│  │  班级日历  │  │  班级通知                                      │  │     ││
│  │  一二三四   │  │  · 期中答辩时间调整至本周四下午                │  │     ││
│  │  五六日     │  │  · 周五班会地点变更为主楼 A201                │  │     ││
│  │  [活动日历] │  │  · 实验室值班表已更新，请及时查看              │  │     ││
│  │  1 2 3 4 5 │  └───────────────────────────────────────────────┘  │  签到││
│  │  6 7 8 9 10│                                                        │  板块││
│  │  ●●        ●│  ┌───────────────────────────────────────────────┐  │     ││
│  │            │  │  博客推送（按时间）                            │  │     ││
│  │            │  │  ─────────────────────────────────────────────│  │     ││
│  │            │  │  2025-01-10  · 机器学习入门指南    张三        │  │     ││
│  │            │  │  2025-01-09  · 数据结构与算法      李四        │  │     ││
│  │            │  │  2025-01-08  · 项目实践总结        王五        │  │     ││
│  │            │  │                                                │  │     ││
│  │            │  │                          [查看更多博客 →]      │  │     ││
│  │            │  └───────────────────────────────────────────────┘  └─────┘│
│  └────────────┘                                                           │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 内容说明
- **Hero 区域**：欢迎语 + 简短介绍
- **三栏布局**：
  - **左侧栏**（320px）：
    - 班级日历：缩小版月视图，显示活动标记，**点击日期显示当日日程**
  - **中间栏**（最大 960px）：主内容区
    - 班级通知：展示最新 3-5 条通知
    - 博客推送：按时间倒序的简洁列表，可点击跳转详情
  - **右侧栏**（320px）：签到板块
    - sticky 定位，滚动时保持可见
    - 每日签到、运势抽签、连续打卡记录

### 日历交互功能

**点击日期显示日程：**
- 点击任意日期，日历下方展开显示当日日程
- 有活动的日期（带点标记）显示具体时间和事件
- 无活动的日期显示"暂无日程安排"
- 点击"×"按钮关闭日程显示
- 选中的日期高亮显示（深色背景）

**示例日程数据：**
- 1月3日：期中答辩（14:00）、班级会议（16:00）
- 1月7日：班会（19:00）、小组讨论（20:30）
- 1月11日：实验室值班（10:00）、项目讨论（15:00）
- 1月15日：项目展示（09:00）、导师面谈（13:00）

---

## 4.1 签到功能（新增 v1.3.0）

### 功能概述
在首页右侧添加趣味签到板块，包含每日签到、运势抽签、连续打卡记录等功能，增加用户活跃度和趣味性。

### 页面布局

#### 4.1.1 签到欢迎页（未签到状态）

```
┌───────────────────┐
│   欢迎回来，       │
│   SHLAMING        │  ← 用户昵称（金色高亮）
│                   │
│  ───────────────  │
│                   │
│  一月大  19  星期一 │  ← 当前日期（大字显示）
│                   │
│  ───────────────  │
│                   │
│  距期末考试还剩    │  ← 倒计时信息
│       15 天       │  ← 数字（金色高亮）
│                   │
│  ┌──────────────┐ │
│  │  点击打卡     │ │  ← 橙色按钮
│  └──────────────┘ │
│                   │
└───────────────────┘
```

**视觉设计：**
- 背景：紫色渐变（`#667eea` → `#764ba2`）
- 文字：白色为主，重点信息金色（`#ffd700`）
- 日期数字：超大号（3.5rem），金色
- 签到按钮：橙色（`#ff9500`），带悬浮动画效果
- 位置：右侧边栏，sticky 定位（滚动时保持可见）

#### 4.1.2 签到结果页（已签到状态）

```
┌───────────────────┐
│  SHLAMING 的运势  │  ← 用户昵称（金色）
│                   │
│    ╖中吉╜         │  ← 运势等级（红色，超大号）
│                   │
│  ┌─────────────┐ │
│  │ 宜：         │ │  ← 绿色标签
│  │ · 写代码     │ │     （灵感充沛，效率奇高）
│  │ · 复习       │ │     （记忆超群，过目不忘）
│  └─────────────┘ │
│                   │
│  ┌─────────────┐ │
│  │ 忌：         │ │  ← 红色标签
│  │ · 熬夜       │ │     （身体疲惫，效率低下）
│  │ · 刷手机     │ │     （浪费时间，虚度光阴）
│  └─────────────┘ │
│                   │
│  ┌──────────────┐ │
│  │ 你已经在 V4Corner│  ← 连续打卡天数
│  │   连续打卡了 1 天│     （数字金色）
│  └──────────────┘ │
│                   │
│  ┌──────────────┐ │
│  │    关闭       │ │  ← 半透明白色按钮
│  └──────────────┘ │
│                   │
└───────────────────┘
```

**视觉设计：**
- 运势等级：超大号（2.5rem），带缩放动画
- 宜忌标签：左右两栏布局，绿色/红色区分
- 连续打卡：半透明背景区域，数字金色
- 关闭按钮：半透明白色，悬浮变深

### 运势等级系统

| 等级 | 颜色 | 出现概率 | 说明 |
|------|------|----------|------|
| 大吉 | `#ff4757` | 15% | 运气极佳，适合学习和创作 |
| 中吉 | `#ff6b6b` | 30% | 运气不错，大部分事情顺利 |
| 小吉 | `#ffa502` | 30% | 运气平稳，保持平常心 |
| 末吉 | `#ff7f50` | 15% | 运气一般，需谨慎行事 |
| 凶 | `#a55eea` | 10% | 运气不佳，宜静不宜动 |

### 宜忌建议库

每个运势等级包含 2 个"宜"和 2 个"忌"的建议：

**大吉：**
- 宜：写代码（灵感充沛，效率奇高）
- 宜：学习（理解力强，事半功倍）
- 忌：熬夜（身体疲惫，容易生病）
- 忌：拖延（今日事明日毕，效率低下）

**中吉：**
- 宜：写代码（灵感充沛，效率奇高）
- 宜：复习（记忆超群，过目不忘）
- 忌：熬夜（身体疲惫，效率低下）
- 忌：刷手机（浪费时间，虚度光阴）

**小吉：**
- 宜：阅读（心静神宁，收获满满）
- 宜：运动（身体舒畅，精力充沛）
- 忌：暴食（肠胃不适，影响状态）
- 忌：赖床（虚度时光，错过良机）

**末吉：**
- 宜：整理（条理清晰，心情愉悦）
- 宜：思考（思路清晰，洞察力强）
- 忌：冲动（决策失误，后悔莫及）
- 忌：贪多（贪多嚼不烂，适得其反）

**凶：**
- 宜：休息（养精蓄锐，恢复状态）
- 宜：反思（总结经验，吸取教训）
- 忌：冒险（风险极大，得不偿失）
- 忌：争论（容易起冲突，得不偿失）

### 交互说明

#### 签到流程
1. 用户点击"点击打卡"按钮
2. 检查登录状态：
   - 未登录：弹出提示"请先登录后再签到"，跳转到登录页
   - 已登录：继续签到流程
3. 检查今日是否已签到：
   - 已签到：弹出提示"今天已经签到过了哦"
   - 未签到：显示"签到中..."，按钮禁用
4. 模拟 API 调用（800ms）
5. 随机抽取运势结果
6. 切换到结果页面，显示：
   - 运势等级（带缩放动画）
   - 宜忌建议
   - 连续打卡天数
7. 显示成功提示："签到成功！"

#### 关闭结果页
1. 用户点击"关闭"按钮
2. 返回欢迎页面
3. 如果已签到，按钮显示"已签到"并禁用

#### 连续打卡规则
- 首次签到：连续 1 天
- 每日签到：连续天数 +1
- 中断签到：连续天数重置为 1（刷新页面或次日重置）

### 响应式设计

#### 桌面端（>1400px）
- 三栏布局：左侧栏（320px）+ 中间栏（最大 960px）+ 右侧栏（320px）
- 签到板块：右侧栏，sticky 定位，距离顶部 5rem
- 日期数字：3.5rem

#### 平板端（768px-1400px）
- 左侧栏隐藏
- 中间栏和右侧栏上下排列
- 签到板块：移动到主内容上方
- 位置：static 定位（不随滚动固定）
- 主内容区：恢复全宽显示
- 日期数字：3rem

#### 移动端（<768px）
- 签到板块：主内容上方
- 运势等级：2rem
- 宜忌建议：上下堆叠（非左右两栏）
- 日期数字：2.5rem

### 动画效果

#### 签到按钮悬浮
```css
hover: translateY(-2px)
shadow: 0 6px 16px rgba(255, 149, 0, 0.4)
```

#### 运势等级显示
```css
@keyframes fortuneAppear {
    0%: opacity: 0, scale(0.5)
    50%: scale(1.1)
    100%: opacity: 1, scale(1)
}
duration: 0.6s
```

### 数据模型需求

### CheckIn（签到记录）
```typescript
{
    id: number;
    user_id: number;           // 用户ID（外键）
    checkin_date: string;      // 签到日期（YYYY-MM-DD）
    fortune_level: string;     // 运势等级（大吉/中吉/小吉/末吉/凶）
    streak_days: number;       // 连续签到天数
    created_at: string;        // 签到时间
}
```

### User（用户字段扩展）
```typescript
{
    // ... 现有字段
    total_checkin_days: number;    // 累计签到天数
    max_streak_days: number;       // 最长连续签到天数
    last_checkin_date: string;     // 最后签到日期
}
```

---

## 5. 班级通知系统（新增 v1.3.2）

### 功能概述
完整的班级通知系统，支持富文本内容、重要标记、浏览量统计、权限控制等功能。包含通知列表页和通知详情页。

### 5.1 通知列表页 `/notices`

#### 页面布局
```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] [班级通知] │
├─────────────────────────────────────┤
│                                     │
│  班级通知                  [+ 发布通知]│
│  ───────────────────────────────     │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ [重要] 期中答辩时间调整     │   │
│  │ 辅导员 · 01-12 · 浏览 156   │   │
│  │ 请各位同学做好准备，答      │   │
│  │ 辩地点：主楼 A301...        │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 周五班会地点变更            │   │
│  │ 班长 · 01-11 · 浏览 89      │   │
│  │ 原定地点因故无法使用，      │   │
│  │ 请同学们相互转告...         │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 实验室值班表已更新          │   │
│  │ 学习委员 · 01-10 · 浏览 67  │   │
│  │ 新的值班安排从本周开始      │   │
│  │ 执行...                     │   │
│  └─────────────────────────────┘   │
│                                     │
│  < 1 2 3 4 5 ... 12 >              │
│                                     │
└─────────────────────────────────────┘
```

#### 功能特性
- **卡片式布局**：每条通知一个卡片
- **重要标记**：红色徽章显示"重要"
- **Hover 效果**：悬浮时上浮 2px、阴影增强、边框高亮
- **元信息**：发布者、日期、浏览量
- **分页浏览**：每页 10 条，支持翻页
- **发布按钮**：管理员/班委可见

#### 样式规格
- 卡片圆角：8px
- 卡片阴影：`0 1px 3px rgba(0,0,0,0.1)`
- Hover 阴影：`0 4px 12px rgba(15, 23, 42, 0.12)`
- 重要标记：红色背景 `#ef4444`、白色文字、圆角 10px
- 元信息颜色：`#64748b`（灰色）
- 卡片间距：1rem

---

### 5.2 通知详情页 `/notices/:id`

#### 页面布局
```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] [班级通知] │
├─────────────────────────────────────┤
│                                     │
│  班级通知 > 通知标题                │
│  ───────────────────────────────     │
│                                     │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │  [重要] 期中答辩时间调整     │   │
│  │  至本周四下午                │   │
│  │                             │   │
│  │  发布者：辅导员              │   │
│  │  发布时间：2025-01-12 10:30 │   │
│  │  浏览次数：156               │   │
│  │                             │   │
│  ├─────────────────────────────┤   │
│  │                             │   │
│  │  各位同学：                 │   │
│  │                             │   │
│  │  由于教室安排冲突，原定于   │   │
│  │  本周五进行的期中答辩时间   │   │
│  │  调整至本周四下午进行。     │   │
│  │                             │   │
│  │  ## 答辩安排                │   │
│  │                             │   │
│  │  **时间：**1月16日（周四）  │   │
│  │  14:00-17:00                │   │
│  │                             │   │
│  │  **地点：**主楼 A301        │   │
│  │                             │   │
│  │  ### 注意事项               │   │
│  │                             │   │
│  │  - 请提前10分钟到场签到     │   │
│  │  - 准备5分钟的PPT演示       │   │
│  │  - 携带纸质版项目报告       │   │
│  │                             │   │
│  │  ## 答辩顺序                │   │
│  │                             │   │
│  │  1. 14:00-14:30 第一组      │   │
│  │  2. 14:30-15:00 第二组      │   │
│  │  ...                        │   │
│  │                             │   │
│  │  请各位同学认真准备，       │   │
│  │  预祝答辩顺利！             │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  [编辑] [删除] [返回]                │
│                                     │
└─────────────────────────────────────┘
```

#### 功能特性
- **面包屑导航**：快速返回列表
- **重要标签**：红色徽章显示"重要"
- **元信息区**：发布者、时间、浏览量
- **Markdown 渲染**：支持标题、列表、粗体、链接等
- **操作按钮**：编辑、删除（仅发布者和管理员可见）
- **浏览量自动 +1**：每次查看自动增加

#### 样式规格
- 面包屑颜色：`#64748b`（灰色）
- 重要标签：红色背景 `#ef4444`、白色文字、圆角 10px
- 内容区：Markdown 渲染，继承全局 Markdown 样式
- 操作按钮：次要按钮样式

---

### 5.3 通知发布/编辑表单

#### 页面布局
```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] [班级通知] │
├─────────────────────────────────────┤
│                                     │
│  发布通知                    [保存] │
│  ───────────────────────────────     │
│                                     │
│  标题                               │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  └─────────────────────────────┘   │
│  (1-200 字符)                      │
│                                     │
│  内容 (支持 Markdown)               │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │                             │   │
│  │                             │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│  (1-10000 字符)                    │
│                                     │
│  □ 标记为重要通知                   │
│                                     │
│  [预览] [取消] [保存]               │
│                                     │
└─────────────────────────────────────┘
```

#### 表单字段
| 字段 | 类型 | 必填 | 验证规则 |
|------|------|------|----------|
| title | string | 是 | 1-200 字符 |
| content | string | 是 | Markdown 格式，1-10000 字符 |
| is_important | boolean | 否 | 默认 false |

---

### 5.4 交互说明

#### 查看通知流程
1. 从首页或导航栏进入通知列表页
2. 浏览通知卡片，查看标题、摘要、元信息
3. 点击卡片进入通知详情页
4. 详情页自动 +1 浏览量
5. 阅读 Markdown 格式的完整内容
6. 点击"返回"或面包屑返回列表

#### 发布通知流程（管理员/班委）
1. 点击通知列表页的"[+ 发布通知]"按钮
2. 填写标题（必填）
3. 填写内容（必填，支持 Markdown）
4. 勾选"标记为重要通知"（可选）
5. 点击"预览"查看渲染效果
6. 点击"保存"发布通知
7. 自动跳转到通知详情页

#### 编辑通知流程（发布者/管理员）
1. 在通知详情页点击"编辑"按钮
2. 修改标题或内容
3. 保存更改，记录更新时间
4. 返回通知详情页

#### 删除通知流程（发布者/管理员）
1. 在通知详情页点击"删除"按钮
2. 弹出确认对话框："确定要删除这条通知吗？"
3. 确认后删除通知
4. 返回通知列表页

---

### 5.5 权限控制

| 操作 | 未登录 | 普通用户 | 管理员/班委 |
|------|--------|----------|-------------|
| 查看通知列表 | ✅ | ✅ | ✅ |
| 查看通知详情 | ✅ | ✅ | ✅ |
| 发布通知 | ❌ | ❌ | ✅ |
| 编辑通知 | ❌ | 仅自己发布的 | ✅ |
| 删除通知 | ❌ | 仅自己发布的 | ✅ |

---

### 5.6 数据模型

#### Notice（通知）
```typescript
{
    id: number;
    title: string;              // 标题（1-200 字符）
    content: string;            // Markdown 内容（1-10000 字符）
    excerpt: string;            // 摘要（前 100 字）
    is_important: boolean;      // 是否重要
    author_id: number;          // 发布者 ID（外键）
    author_name: string;        // 发布者名称（冗余存储）
    views: number;              // 浏览次数
    published_at: string;       // 发布时间（ISO 8601）
    updated_at: string;         // 更新时间（可为 null）
    date_display: string;       // 显示用日期（MM-DD）
}
```

---

## 6. 博客列表页 `/blogs`（改进 v1.8.0 草稿入口）

### 当前状态
简单的网格布局，显示博客卡片

### 改进后布局

```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] ...  │
├─────────────────────────────────────┤
│                                     │
│  博客              [写博客] [草稿箱(3)]│
│  ───────────────────────────────    │
│                                     │
│  筛选：[全部] [我的博客]            │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 博客标题              [详情] │   │
│  │ 张三 · 2025-01-10               │   │
│  │                                 │   │
│  │ 这是博客摘要，显示前150个字...   │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 另一篇博客            [详情] │   │
│  │ 李四 · 2025-01-09               │   │
│  │                                 │   │
│  │ 这是另一篇博客的摘要...          │   │
│  └─────────────────────────────┘   │
│                                     │
│  [加载更多]                         │
│                                     │
└─────────────────────────────────────┘
```

### 功能说明（v1.8.0 更新）
- **写博客按钮**：已登录用户可见，点击跳转到创建博客页面
- **草稿箱按钮**（新增）：已登录用户可见
  - 显示草稿数量徽章
  - 点击跳转到草稿箱页面
  - 样式：次要按钮（outline），带数量提示
- **筛选**：未登录时只显示"全部"，已登录时显示"全部"和"我的博客"
- **博客卡片**：
  - 标题（可点击跳转到详情）
  - 作者 + 发布时间
  - 摘要（内容前150字）
  - "详情"按钮（右侧）
- **分页**：每页显示 10 篇，底部"加载更多"按钮

---

## 6. 博客详情页 `/blogs/:id`（新增，参考博客园风格）

### 页面布局

```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] ...  │
├─────────────────────────────────────┤
│                                     │
│  博客首页 > [博客标题]               │
│                                     │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │  博客标题                     │   │
│  │  ───────────────────────     │   │
│  │                             │   │
│  │  作者：张三                   │   │
│  │  发布时间：2025-01-10 08:30  │   │
│  │  阅读次数：128                │   │
│  │                             │   │
│  │  [编辑] [删除]  ← 仅作者可见 │   │
│  │                             │   │
│  ├─────────────────────────────┤   │
│  │                             │   │
│  │  博客正文内容...              │   │
│  │                             │   │
│  │  这是博客的完整内容，支持：  │   │
│  │  - 段落                      │   │
│  │  - 标题（H1, H2, H3...）     │   │
│  │  - 代码块（语法高亮）        │   │
│  │  - 图片                      │   │
│  │  - 链接                      │   │
│  │  - 列表                      │   │
│  │                             │   │
│  │  正文内容继续...              │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  评论区（计划功能）          │   │
│  ├─────────────────────────────┤   │
│  │  [暂无评论]                  │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### 设计说明（参考博客园）

**博客标题区域**：
- 大标题（H1）
- 下方分隔线
- 元信息区域：
  - 作者：[作者名]（可点击跳转到用户个人中心）
  - 发布时间：YYYY-MM-DD HH:MM
  - 阅读次数：自动统计
- 操作按钮（仅作者可见）：
  - [编辑]：跳转到编辑页面
  - [删除]：弹出确认对话框

**正文内容区域**：
- 白色卡片容器
- 内容宽度适配（最大 800px）
- 支持 Markdown 渲染：
  - 标题层级（H1-H6）
  - 代码块（带语法高亮）
  - 图片（支持上传，自动缩放）
  - 引用块
  - 列表（有序/无序）
  - 表格
  - 链接
- 字体大小：16px（正文）
- 行高：1.8
- 段落间距：1em

**评论区域**（计划功能）：
- 已登录用户可发表评论
- 显示所有评论（按时间倒序）
- 评论作者可删除自己的评论

### 交互说明
- 点击博客标题可返回顶部
- 点击作者名跳转到作者的个人中心
- 点击"编辑"跳转到编辑页面（`/blogs/:id/edit`）
- 点击"删除"弹出确认对话框，确认后调用删除 API
- 删除成功后跳转到博客列表页

---

## 6.5 草稿箱页面 `/blogs/drafts`（新增 v1.8.0）

### 功能概述
显示当前用户的所有草稿，支持继续编辑、发布、删除操作。

### 页面布局

```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] ...  │
├─────────────────────────────────────┤
│                                     │
│  [← 返回]  我的草稿箱          (3 篇)│
│  ───────────────────────────────    │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  草稿标题                    │   │
│  │  最后编辑：2小时前           │   │
│  │  [继续编辑] [发布] [删除]     │   │
│  │                             │   │
│  │  这是草稿内容的预览，显示    │   │
│  │  前几行文字...               │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  未命名草稿                  │   │
│  │  最后编辑：昨天              │   │
│  │  [继续编辑] [发布] [删除]     │   │
│  │                             │   │
│  │  （此草稿暂无内容）          │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  机器学习笔记 - 第三章       │   │
│  │  最后编辑：3天前             │   │
│  │  [继续编辑] [发布] [删除]     │   │
│  │                             │   │
│  │  本章介绍了神经网络的基本    │   │
│  │  概念和前向传播算法...       │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### 功能特性

**页面结构**：
- 面包屑导航：[博客首页] > [我的草稿箱]
- 标题区：显示"我的草稿箱"和草稿总数
- 草稿列表：按最后编辑时间倒序排列

**草稿卡片显示**：
- 草稿标题（未命名草稿显示"未命名草稿"）
- 最后编辑时间（相对时间：刚刚、2小时前、昨天等）
- 草稿内容预览（前2行，最多100字）
- 操作按钮：[继续编辑] [发布] [删除]

**操作功能**：
- **[继续编辑]**：
  - 点击跳转到编辑页面（`/blogs/{draft_id}/edit`）
  - 编辑页面显示草稿状态
  - 可以继续编辑并保存草稿或直接发布

- **[发布]**：
  - 弹出确认对话框："确定要发布这篇草稿吗？"
  - 确认后发布博客，状态变更为已发布
  - 自动跳转到博客详情页

- **[删除]**：
  - 弹出确认对话框："确定要删除这篇草稿吗？此操作无法撤销。"
  - 确认后删除草稿
  - 从列表中移除

**空状态**：
```
┌─────────────────────────────────────┐
│                                     │
│         暂无草稿                     │
│                                     │
│  ┌─────────────┐                   │
│  │  📝         │                   │
│  │             │                   │
│  └─────────────┘                   │
│                                     │
│  还没有保存的草稿，点击"写博客"      │
│  创建新博客时可以保存为草稿         │
│                                     │
│  [去写博客]                         │
│                                     │
└─────────────────────────────────────┘
```

### 权限控制
- 需要登录才能访问
- 只显示当前用户自己的草稿
- 未登录用户访问自动跳转到登录页

### 样式规格
- 页面最大宽度：960px，居中
- 草稿卡片高度：自适应（最小 120px）
- 卡片间距：1rem
- 草稿标题：18px，加粗
- 最后编辑时间：14px，灰色
- 内容预览：14px，最多显示2行
- 操作按钮：右对齐

### 交互说明

#### 继续编辑流程
1. 点击草稿卡片的[继续编辑]按钮
2. 跳转到编辑页面，预填充草稿内容
3. 顶部显示"状态: 草稿"（黄色标签）
4. 可以编辑内容后选择：
   - [保存草稿]：更新草稿内容
   - [发布博客]：发布为正式博客

#### 发布流程
1. 点击草稿卡片的[发布]按钮
2. 弹出确认对话框
3. 确认后调用发布 API
4. 成功后跳转到博客详情页
5. 从草稿箱中移除该草稿

#### 删除流程
1. 点击草稿卡片的[删除]按钮
2. 弹出确认对话框
3. 确认后调用删除 API
4. 成功后从列表中移除该草稿
5. 显示成功提示："草稿已删除"

### 数据模型

#### Blog（草稿状态扩展）
```typescript
{
  id: number;
  title: string;              // 标题
  content: string;            // 富文本内容
  status: 'draft' | 'published';  // 状态（新增）
  author_id: number;          // 作者ID
  author_name: string;        // 作者名
  views: number;              // 阅读次数（草稿时为0）
  created_at: string;         // 创建时间
  updated_at: string;         // 最后编辑时间
}
```

---

## 7. 创建博客页面 `/blogs/new`（新增 v1.8.0 草稿支持）

### 页面布局

```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] ...  │
├─────────────────────────────────────┤
│                                     │
│  [← 返回]          创建新博客        │
│  ───────────────────────────────    │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  标题 *                      │   │
│  │  [________________]          │   │
│  │  (1-200 字符)                │   │
│  │                             │   │
│  │  内容 *                      │   │
│  │  ┌─────────────────────┐    │   │
│  │  │                     │    │   │
│  │  │  富文本编辑器        │    │   │
│  │  │  (TipTap)           │    │   │
│  │  │                     │    │   │
│  │  │                     │    │   │
│  │  └─────────────────────┘    │   │
│  │                             │   │
│  │  [预览]                      │   │
│  │                             │   │
│  │  [取消] [保存草稿] [发布博客] │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### 字段说明

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| title | string | 保存草稿时否，发布时是 | 1-200字符 |
| content | string | 保存草稿时否，发布时是 | 富文本格式 |

### 功能说明（v1.8.0 更新）
- **标题输入框**：单行文本，最多200字符
- **内容编辑器**：
  - TipTap 富文本编辑器（v1.7.0 集成）
  - 支持文本格式化、标题、列表、链接
  - 支持图片/视频上传
- **预览功能**：
  - 点击"预览"按钮，显示渲染后的效果
  - 可以在编辑和预览之间切换
- **操作按钮**（v1.8.0 新增）：
  - [取消]：返回上一页或博客列表
  - **[保存草稿]**：保存为草稿（只需填写标题）
  - **[发布博客]**：发布博客（标题和内容都必填）

### 验证规则
- **保存草稿**：
  - 标题：必填，1-200字符
  - 内容：可选
- **发布博客**：
  - 标题：必填，1-200字符
  - 内容：必填，不能为空

### 样式规格
- 编辑框宽度：100%
- 内容编辑器高度：400px
- 预览区域与编辑器等高
- 按钮右对齐
- [保存草稿] 按钮样式：次要按钮（outline）
- [发布博客] 按钮样式：主要按钮（primary）

---

## 8. 编辑博客页面 `/blogs/:id/edit`（新增 v1.8.0 草稿支持）

### 页面布局

```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] ...  │
├─────────────────────────────────────┤
│                                     │
│  [← 返回]          编辑博客          │
│  ───────────────────────────────    │
│                                     │
│  状态: [草稿] 或 [已发布]             │
│  ───────────────────────────────    │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  标题 *                      │   │
│  │  [________________]          │   │
│  │  (1-200 字符)                │   │
│  │                             │   │
│  │  内容 *                      │   │
│  │  ┌─────────────────────┐    │   │
│  │  │                     │    │   │
│  │  │  富文本编辑器        │    │   │
│  │  │  (TipTap)           │    │   │
│  │  │                     │    │   │
│  │  │                     │    │   │
│  │  └─────────────────────┘    │   │
│  │                             │   │
│  │  [预览]                      │   │
│  │                             │   │
│  │  [取消] [保存草稿] [发布博客] │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### 功能说明（v1.8.0 更新）
- **状态显示**：
  - 顶部显示当前博客状态（草稿/已发布）
  - 草稿状态：黄色标签
  - 已发布状态：绿色标签
- **表单预填充**：当前博客的标题和内容
- **操作按钮**（v1.8.0 更新）：
  - [取消]：返回博客详情页
  - **[保存草稿]**：保存为草稿
    - 如果当前是已发布状态，保存为草稿后状态变为草稿
    - 如果当前是草稿状态，更新草稿内容
  - **[发布博客]**：发布博客
    - 草稿→已发布：状态变为已发布
    - 已发布→已发布：更新已发布内容

### 状态转换说明
```
草稿状态:
  [保存草稿] → 保持草稿状态，更新内容
  [发布博客] → 变更为已发布状态

已发布状态:
  [保存草稿] → 变更为草稿状态（内容降级为草稿）
  [发布博客] → 保持已发布状态，更新内容
```

### 权限控制
- 只有博客作者可以编辑
- 非作者访问显示 403 错误页面

---

## 9. 用户个人中心 `/users/:id`（新增）

### 页面布局

```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] ...  │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  ┌─────┐  张三              │   │
│  │  │头像 │  @zhangsan         │   │
│  │  └─────┘                    │   │
│  │                             │   │
│  │  车辆4班 · 清华大学          │   │
│  │                             │   │
│  │  [编辑资料] ← 仅本人可见     │   │
│  └─────────────────────────────┘   │
│                                     │
│  个人简介：                          │
│  这是张三的个人简介...              │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  统计信息                    │   │
│  ├─────────────────────────────┤   │
│  │  发布博客：15 篇             │   │
│  │  注册时间：2024-09-01        │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  TA 的博客                   │   │
│  ├─────────────────────────────┤   │
│  │  · 机器学习入门              │   │
│  │  · 项目实践总结              │   │
│  │  · 数据结构与算法            │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### 信息说明

**用户基本信息**：
- 头像：默认头像或自定义（80x80px，圆形）
- 昵称：显示昵称或用户名
- 用户名：@username
- 班级/学校（可选）：自由填写
- 个人简介（可选）：最多200字

**统计信息**：
- 发布博客数：自动统计
- 注册时间：YYYY-MM-DD

**TA 的博客列表**：
- 显示该用户发布的所有博客（最多显示 10 篇）
- 按发布时间倒序
- 点击跳转到博客详情

### 交互说明
- 点击"编辑资料"（仅本人可见），弹出编辑对话框
- 编辑资料可修改：昵称、班级/学校、个人简介、头像

---

## 10. 成员列表页 `/members`（新增）

### 页面布局

```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] ...  │
├─────────────────────────────────────┤
│                                     │
│  班级成员                            │
│  ───────────────────────────────    │
│                                     │
│  搜索：[______________]             │
│                                     │
│  ┌────┐  张三          @zhangsan   │
│  │头像│  车辆4班 · 15篇博客           │
│  └────┘  [查看详情 →]              │
│                                     │
│  ┌────┐  李四          @lisi       │
│  │头像│  车辆4班 · 8篇博客            │
│  └────┘  [查看详情 →]              │
│                                     │
│  ┌────┐  王五          @wangwu     │
│  │头像│  车辆4班 · 12篇博客           │
│  └────┘  [查看详情 →]              │
│                                     │
└─────────────────────────────────────┘
```

### 功能说明
- **搜索**：按用户名或昵称搜索（实时过滤）
- **成员列表**：
  - 头像（40x40px，圆形）
  - 昵称/用户名
  - 班级 + 博客数
  - "查看详情"按钮，点击跳转到个人中心
- **排序**：按注册时间或博客数排序（后期功能）

---

## 11. 编辑资料对话框（弹出）

### 触发方式
在个人中心点击"编辑资料"按钮

### 页面布局

```
┌─────────────────────────────────┐
│  编辑资料                    [X]│
├─────────────────────────────────┤
│                                 │
│  ┌─────┐                        │
│  │头像 │  [更换头像]             │
│  └─────┘                        │
│                                 │
│  昵称                            │
│  [__________________]           │
│                                 │
│  班级/学校                       │
│  [__________________]           │
│                                 │
│  个人简介                        │
│  ┌─────────────────────┐        │
│  │                     │        │
│  │  最多200字          │        │
│  │                     │        │
│  └─────────────────────┘        │
│                                 │
│  [取消]              [保存]     │
│                                 │
└─────────────────────────────────┘
```

### 字段说明

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| nickname | string | 否 | 2-20字符 |
| class | string | 否 | 班级或学校名称 |
| bio | string | 否 | 最多200字 |
| avatar | file | 否 | 图片文件，最大2MB |

### 功能说明
- 头像上传：点击"更换头像"按钮，选择本地图片文件
- 表单验证：失去焦点时验证
- 保存成功后关闭对话框，刷新页面数据

---

## 全局样式规范

### 颜色系统
```css
主色调：#0f172a（深蓝灰）
次要色：#475569（中灰）
背景色：#f8fafc（浅灰）→ #e2e8f0（渐变）
卡片背景：#ffffff（白色）
边框色：#e2e8f0（浅灰边框）
链接色：#0f172a
错误色：#ef4444（红色）
成功色：#10b981（绿色）
```

### 字体系统
```css
字体：Inter / system-ui / -apple-system / sans-serif
标题大小：
  H1: 32px / 1.2（博客详情页标题）
  H2: 24px / 1.3
  H3: 20px / 1.4
正文字体：16px / 1.8（行高）
小字：14px / 1.5
```

### 间距系统
```css
卡片内边距：1rem（16px）
卡片间距：1rem（16px）
页面左右边距：1.5rem（24px）
页面顶部边距：2rem（32px）
```

### 阴影
```css
卡片阴影：0 2px 8px rgba(15, 23, 42, 0.06)
导航栏阴影：0 2px 6px rgba(15, 23, 42, 0.04)
悬浮阴影：0 4px 12px rgba(15, 23, 42, 0.12)
```

---

## 响应式设计

### 断点
- **移动端**：< 768px
- **平板**：768px - 1024px
- **桌面**：> 1024px

### 移动端适配
- 导航栏：折叠为菜单按钮
- 博客列表：单列布局
- 博客详情：内容宽度自适应
- 表单：输入框宽度100%

---

## 交互反馈

### 加载状态
- 按钮点击后显示 loading 状态（禁用 + 旋转图标）
- 页面加载时显示骨架屏或 loading 文字

### 错误提示
- 表单验证错误：输入框下方红色文字
- API 错误：顶部 Toast 提示（3秒自动消失）
- 404/403 页面：友好的错误提示页面

### 成功提示
- 操作成功后：顶部 Toast 提示（绿色，2秒自动消失）
- 创建/编辑博客成功：跳转到详情页

---

## 数据模型需求

基于以上原型设计，需要的数据模型：

### User（用户）
```typescript
{
  id: number;
  username: string;        // 用户名（唯一，登录用）
  email: string;           // 邮箱（唯一）
  password_hash: string;   // 密码哈希（不返回给前端）
  nickname: string;        // 昵称（显示用）
  avatar_url: string;      // 头像URL
  class: string;           // 班级/学校
  bio: string;             // 个人简介
  created_at: string;      // 注册时间
}
```

### Blog（博客）
```typescript
{
  id: number;
  title: string;           // 标题
  content: string;         // Markdown内容
  author_id: number;       // 作者ID
  author_name: string;     // 作者名（冗余，方便查询）
  views: number;           // 阅读次数
  created_at: string;      // 创建时间
  updated_at: string;      // 更新时间
}
```

---

## 12. AI对话列表页 `/chat`（新增）

### 页面布局

```
┌─────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] [AI对话] 💬 │
├─────────────────────────────────────┤
│                                     │
│  AI对话                    [+ 新对话]│
│  ───────────────────────────────    │
│                                     │
│  搜索对话：[______________]         │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  💬 机器学习入门指南         │   │
│  │     最后消息：如何理解梯度... │   │
│  │     2025-01-15 14:30        │   │
│  ├─────────────────────────────┤   │
│  │  💬 Python代码调试帮助       │   │
│  │     最后消息：感谢你的帮助！  │   │
│  │     2025-01-14 09:15        │   │
│  ├─────────────────────────────┤   │
│  │  💬 项目架构设计讨论         │   │
│  │     最后消息：我觉得可以...  │   │
│  │     2025-01-12 16:45        │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### 功能说明

**页面结构**：
- 顶部：标题 + [新对话] 按钮
- 搜索栏：实时过滤对话列表
- 对话列表：按最近更新时间倒序排列

**对话卡片显示**：
- 对话标题（用户首次输入或自动生成）
- 最后一条消息预览（最多50字，超出省略）
- 最后更新时间（相对时间：刚刚、2小时前、昨天等）

**操作功能**：
- [新对话]：点击创建新的对话，跳转到对话详情页
- 点击对话卡片：进入该对话的详情页
- 长按/右键对话卡片：显示删除选项（弹出确认对话框）

### 权限控制
- 需要登录才能访问
- 只显示当前用户自己的对话历史

### 样式规格
- 页面最大宽度：960px，居中
- 对话卡片高度：80px
- 卡片间距：12px
- 悬浮效果：浅灰背景 + 轻微阴影

---

## 13. AI对话详情页 `/chat/:id`（新增，参考ChatGPT风格）

### 页面布局

```
┌─────────────────────────────────────────────────────────┐
│ [V4Corner] [首页] [博客] [成员] [AI对话] 💬              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [← 返回]        机器学习入门指南              [⋮]      │
│  ───────────────────────────────────────────────────   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  👤 用户 · 刚刚                                  │  │
│  │  ─────────────────────────────────────────────  │  │
│  │  请帮我解释一下什么是梯度下降算法？              │  │
│  │                                                  │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  🤖 AI · 刚刚                                   │  │
│  │  ─────────────────────────────────────────────  │  │
│  │  梯度下降是一种优化算法，主要用于最小化损失函数。 │  │
│  │                                                  │  │
│  │  **基本原理：**                                  │  │
│  │  1. 从一个初始点开始                             │  │
│  │  2. 计算该点的梯度（斜率）                        │  │
│  │  3. 沿梯度的反方向移动一小步                      │  │
│  │  4. 重复步骤2-3，直到达到最小值                  │  │
│  │                                                  │  │
│  │  **形象比喻：**                                  │  │
│  │  想象你在山上，想要下山到最低点。梯度下降就像是   │  │
│  │  每次都往脚下的最陡方向迈一步，最终你会到达山谷。  │  │
│  │                                                  │  │
│  │  [📋 复制] [👍 有帮助] [👎 无帮助]               │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  👤 用户 · 2分钟前                              │  │
│  │  ─────────────────────────────────────────────  │  │
│  │  能用一个简单的代码示例说明吗？                  │  │
│  │                                                  │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  🤖 AI · 2分钟前                                │  │
│  │  ─────────────────────────────────────────────  │  │
│  │  当然！这是一个简单的Python示例：                │  │
│  │                                                  │  │
│  │  ```python                                      │  │
│  │  def gradient_descent():                         │  │
│  │      x = 10  # 初始位置                          │  │
│  │      learning_rate = 0.1  # 学习率              │  │
│  │      for i in range(100):                       │  │
│  │          gradient = 2 * x  # 导数               │  │
│  │          x = x - learning_rate * gradient       │  │
│  │      return x                                    │  │
│  │  ```                                            │  │
│  │                                                  │  │
│  │  [📋 复制] [👍 有帮助] [👎 无帮助]               │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  ○ 停止生成                                            │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │  [输入消息给AI...]                  [发送] 📤    │  │
│  │                                                  │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 设计说明（参考ChatGPT风格）

#### **整体布局**
- **全屏对话界面**：最大化对话内容显示区域
- **中央内容区**：最大宽度 768px，居中显示
- **消息流式布局**：从上到下按时间顺序排列，最新消息在底部
- **自动滚动**：新消息出现时自动滚动到底部

#### **消息气泡设计**

**用户消息**：
- 背景色：`#0f172a`（深色）
- 文字：白色
- 对齐：右对齐
- 最大宽度：70%
- 内边距：12px 16px
- 圆角：12px

**AI消息**：
- 背景色：`#f1f5f9`（浅灰）
- 文字：`#0f172a`（深色）
- 对齐：左对齐
- 最大宽度：85%
- 内边距：16px
- 圆角：12px
- 支持Markdown渲染（代码块、列表、加粗等）

#### **消息头部信息**
- 用户名：👤 用户 / 🤖 AI
- 时间：相对时间（刚刚、2分钟前、1小时前等）
- 字体：12px，灰色

#### **AI消息操作按钮**（悬浮显示）
- 📋 复制：复制消息内容到剪贴板
- 👍 有帮助：标记为有帮助（反馈）
- 👎 无帮助：标记为无帮助（反馈）
- 按钮仅在鼠标悬浮时显示，保持界面简洁

#### **输入区域**
- 位置：固定在页面底部
- 输入框：多行文本输入，支持自动扩展高度
- 占位符：`输入消息给AI...`
- 发送按钮：右侧，蓝色背景
- 快捷键：Enter 发送，Shift+Enter 换行

#### **状态显示**
- **AI生成中**：显示"○ 停止生成"按钮
- **停止按钮**：点击后中断AI回复
- **流式输出**：AI回复逐字显示（打字机效果）

### 交互功能

#### **消息交互**
1. **发送消息**：
   - 输入消息后按Enter或点击发送按钮
   - 消息立即显示在对话中（乐观更新）
   - 输入框清空，焦点保持

2. **AI回复**：
   - 显示"AI正在思考..."加载状态
   - 流式输出：逐字显示AI回复
   - 自动滚动到最新消息

3. **停止生成**：
   - AI回复时显示"停止生成"按钮
   - 点击后立即停止输出
   - 已生成部分保留显示

4. **重新生成**：
   - AI回复后显示"重新生成"按钮
   - 点击后重新生成最后一条AI消息

#### **对话管理**
- **标题菜单**（点击右上角[⋮]）：
  - 重命名对话
  - 导出对话（Markdown格式）
  - 删除对话（弹出确认对话框）

- **返回按钮**：点击返回对话列表页

#### **快捷操作**
- 复制消息：点击复制按钮，显示"已复制"提示
- 代码块：点击代码块右上角复制按钮
- 滚动到底部：点击新消息提示（当用户滚动向上查看历史时显示）

### 响应式设计

#### **桌面端**（>1024px）
- 消息最大宽度：用户 70%，AI 85%
- 左右留白：居中显示

#### **平板端**（768px-1024px）
- 消息最大宽度：用户 75%，AI 90%
- 减小左右留白

#### **移动端**（<768px）
- 消息最大宽度：85%
- 全宽输入框
- 隐藏部分操作按钮（保留核心功能）
- 触摸优化的按钮尺寸（最小44px）

### 样式规格

#### **颜色系统**
```css
用户消息背景：#0f172a
AI消息背景：#f1f5f9
页面背景：#ffffff
输入框背景：#ffffff
输入框边框：#e2e8f0
输入框聚焦边框：#0f172a
发送按钮：#0f172a
文字颜色：#0f172a
次要文字：#64748b
```

#### **字体**
```css
消息内容：16px / 1.6（行高）
代码块：14px（Monaco, Consolas, monospace）
时间戳：12px
```

#### **间距**
```css
消息间距：24px
消息内边距：12px 16px（用户）/ 16px（AI）
页面底部留白：120px（为输入框留空间）
```

#### **动画**
```css
消息出现：fade in + slide up（0.3s）
AI打字效果：逐字显示
按钮悬浮：scale(1.05)（0.2s）
```

### 特殊功能

#### **代码高亮**
- 代码块自动语法高亮（使用highlight.js或类似库）
- 支持语言：Python, JavaScript, TypeScript, Java, C++, Go, Rust等
- 显示语言标签
- 一键复制代码块

#### **Markdown渲染**
支持完整的Markdown语法：
- 标题（H1-H6）
- 加粗、斜体
- 列表（有序、无序）
- 代码块（带语法高亮）
- 引用块
- 表格
- 链接
- 图片

#### **上下文管理**
- 显示当前对话的Token使用情况（可选）
- 超长对话自动截取最近N条消息（避免超出上下文限制）
- 提示用户"此对话过长，建议新建对话"

### 错误处理

#### **网络错误**
- 显示"网络连接失败，请检查网络设置"
- 提供"重试"按钮
- 本地保存用户消息（暂存）

#### **API错误**
- 显示"AI服务暂时不可用，请稍后重试"
- 错误消息以红色提示显示

#### **超时**
- 30秒无响应显示"请求超时"
- 提供"重新发送"选项

---

## 14. 新建对话流程

### 创建新对话

**触发方式**：
1. 在AI对话列表页点击[+ 新对话]按钮
2. 在对话详情页点击[新建对话]

**流程**：
1. 自动创建新的对话记录
2. 跳转到对话详情页（`/chat/{new_id}`）
3. 显示欢迎消息：
   ```
   🤖 AI · 刚刚
   ─────────────────────────────────────────────
   你好！我是V4Corner的AI助手。

   我可以帮助你：
   - 解答学习问题
   - 代码调试和优化
   - 项目建议和思路讨论
   - 文档和资料查询

   有什么我可以帮助你的吗？
   ```

**自动命名**：
- 用户发送第一条消息后，自动生成对话标题
- 标题生成规则：提取前30字作为标题
- 用户可以在菜单中手动重命名

---

## 数据模型需求（AI对话功能）

### Conversation（对话）
```typescript
{
  id: number;
  user_id: number;         // 用户ID（外键）
  title: string;           // 对话标题
  created_at: string;      // 创建时间
  updated_at: string;      // 最后更新时间
}
```

### Message（消息）
```typescript
{
  id: number;
  conversation_id: number; // 对话ID（外键）
  role: 'user' | 'assistant'; // 角色
  content: string;         // 消息内容（支持Markdown）
  created_at: string;      // 发送时间
  tokens_used?: number;    // 使用的Token数（可选）
}
```

---

## 版本历史

### v1.8.0 (2026-01-23)
- 新增博客草稿功能（草稿箱页面、创建/编辑页保存草稿）
- 博客列表页添加"草稿箱"入口
- 创建/编辑页面支持保存草稿和发布两种操作

### v1.5.0 (2026-01-22)
- 新增班级通知系统完整设计（通知列表页、通知详情页、发布/编辑表单）
- 完善签到系统设计（运势抽签、宜忌建议）
- 优化首页三栏布局（左栏：通知+数据，中栏：博客，右栏：签到+日历）
- 添加班级数据统计模块

### v1.4.0 (2025-01-21)
- 新增班级日历功能（迷你月视图、点击显示日程）

### v1.3.2 (2025-01-22)
- 去除所有 emoji 图标，采用简洁设计
- 班级数据卡片改为素色背景
- 新增班级通知系统入口

### v1.3.1 (2025-01-21)
- 优化首页布局（三栏布局、数据卡片、博客分类、动态流）

### v1.3.0 (2025-01-20)
- 新增签到功能（欢迎页、运势抽签、结果页）

---

## 下一步

完成原型确认后，进入**API 接口设计**阶段：

1. 根据原型确定所有需要的 API 端点
2. 定义每个接口的请求/响应格式
3. 编写完整的 API 文档（更新 `docs/API.md`）
4. 前后端团队基于 API 文档并行开发
